import os
from dotenv import load_dotenv

from aiogram import Router, F
from aiogram.types import Message, CallbackQuery
from aiogram.filters.command import CommandStart

import Database.requests.orm as rq_orm
import Database.requests.core as rq_core

# import app.keyboards.keyboards as kb
import app.keyboards.inline_keyboards.main_menu_keyboard as inl_kb

from app.panels.admin_panel.admin_menu import main_menu_admin


user_router = Router()

load_dotenv()
admins = int(os.getenv("ADMIN_ID"))


# –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ Start)
@user_router.message(CommandStart())
async def main_menu(message: Message):
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ –∞–¥–º–∏–Ω–∞—Ö
    if message.from_user.id == admins:
        return await main_menu_admin(message)
    
    await rq_orm.AsyncOrm.get_user_tg_id(message.from_user.id) # –§—É–Ω–∫—Ü–∏—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å tg_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await message.answer(f"""
üèãÔ∏è‚Äç‚ôÇÔ∏è –ü—Ä–∏–≤–µ—Ç, {message.from_user.first_name}!

–Ø ‚Äî —Ç–≤–æ–π –ª–∏—á–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø–æ –ø–∏—Ç–∞–Ω–∏—é –ø—Ä—è–º–æ –∑–¥–µ—Å—å, –≤ Telegram! –ú–æ—è —Ü–µ–ª—å ‚Äî –ø–æ–º–æ—á—å —Ç–µ–±–µ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–∏—Ç—å —Å–≤–æ—é —Ñ–æ—Ä–º—É, —Å–∏–ª—É –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.

–í—ã–±–µ—Ä–∏, —Å —á–µ–≥–æ –Ω–∞—á–Ω–µ–º —Å–≤–æ–π –ø—É—Ç—å:

‚Ä¢ üìä –ü—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å ‚Äî —á—Ç–æ–±—ã —è —Å–æ–∑–¥–∞–ª –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –ø–æ–¥ —Ç–≤–æ–∏ —Ü–µ–ª–∏.
‚Ä¢ üéØ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ ‚Äî –≥–æ—Ç–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –∏–º–µ–Ω–Ω–æ –Ω–∞ —Ç–µ–±—è (—Ü–µ–ª–∏, —É—Ä–æ–≤–µ–Ω—å, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å).
‚Ä¢ ü•ó –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø–æ–¥ —Ç–µ–±—è ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω —Å —É—á–µ—Ç–æ–º —Ç–≤–æ–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π.
‚Ä¢ üí™ –ì–æ—Ç–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ ‚Äî –ø–ª–∞–Ω—ã –Ω–∞ —Å–∏–ª—É, –º–∞—Å—Å—É, —Ä–µ–ª—å–µ—Ñ –∏–ª–∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.
‚Ä¢ üìà –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
‚Ä¢ ‚ùì –ü–æ–º–æ—â—å / FAQ ‚Äî –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º.

üéØ –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–∞—á–∞—Ç—å. –ü–µ—Ä–≤—ã–π —à–∞–≥ —É–∂–µ —Å–¥–µ–ª–∞–Ω!
""", reply_markup=await inl_kb.main_menu_kb(), request_timeout=30)
    

# –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ Start)
@user_router.callback_query(F.data == "back_main_menu")
async def main_menu(callback: CallbackQuery):
    await callback.answer()
    
    await rq_orm.AsyncOrm.get_user_tg_id(callback.from_user.id) # –§—É–Ω–∫—Ü–∏—è, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å tg_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await callback.message.edit_text(f"""
üèãÔ∏è‚Äç‚ôÇÔ∏è –ü—Ä–∏–≤–µ—Ç, {callback.from_user.first_name}!

–Ø ‚Äî —Ç–≤–æ–π –ª–∏—á–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä –∏ –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫ –ø–æ –ø–∏—Ç–∞–Ω–∏—é –ø—Ä—è–º–æ –∑–¥–µ—Å—å, –≤ Telegram! –ú–æ—è —Ü–µ–ª—å ‚Äî –ø–æ–º–æ—á—å —Ç–µ–±–µ –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–∏—Ç—å —Å–≤–æ—é —Ñ–æ—Ä–º—É, —Å–∏–ª—É –∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.

–í—ã–±–µ—Ä–∏, —Å —á–µ–≥–æ –Ω–∞—á–Ω–µ–º —Å–≤–æ–π –ø—É—Ç—å:

‚Ä¢ üìä –ü—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å ‚Äî —á—Ç–æ–±—ã —è —Å–æ–∑–¥–∞–ª –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –ø–æ–¥ —Ç–≤–æ–∏ —Ü–µ–ª–∏.
‚Ä¢ üéØ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ ‚Äî –≥–æ—Ç–æ–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω–∞—è –∏–º–µ–Ω–Ω–æ –Ω–∞ —Ç–µ–±—è (—Ü–µ–ª–∏, —É—Ä–æ–≤–µ–Ω—å, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å).
‚Ä¢ ü•ó –ü–ª–∞–Ω –ø–∏—Ç–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –ø–æ–¥ —Ç–µ–±—è ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞—Ü–∏–æ–Ω —Å —É—á–µ—Ç–æ–º —Ç–≤–æ–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π.
‚Ä¢ üí™ –ì–æ—Ç–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ ‚Äî –ø–ª–∞–Ω—ã –Ω–∞ —Å–∏–ª—É, –º–∞—Å—Å—É, —Ä–µ–ª—å–µ—Ñ –∏–ª–∏ –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å.
‚Ä¢ üìà –ú–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å ‚Äî –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è.
‚Ä¢ ‚ùì –ü–æ–º–æ—â—å / FAQ ‚Äî –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–æ—Ç–æ–º.

üéØ –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–∞—á–∞—Ç—å. –ü–µ—Ä–≤—ã–π —à–∞–≥ —É–∂–µ —Å–¥–µ–ª–∞–Ω!
""", reply_markup=await inl_kb.main_menu_kb())